
@{
    ViewBag.Title = "EditHome";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";

    List<GiveAID.Models.entities.banner> banners = new List<GiveAID.Models.entities.banner>();
    if (ViewBag.banner != null)
    {
        banners = ViewBag.banner;
    }
}

<script>
    function previewImages(event) {
        var input = event.target;
        var imagesPreview = document.getElementById('imagesPreview');
        imagesPreview.innerHTML = ''; // Clear any previous images

        if (input.files) {
            var filesAmount = input.files.length;

            for (let i = 0; i < filesAmount; i++) {
                let file = input.files[i];
                let reader = new FileReader();

                reader.onload = function (e) {
                    let imgContainer = document.createElement('div');
                    imgContainer.style.position = 'relative';
                    imgContainer.style.display = 'inline-block';
                    imgContainer.style.marginRight = '10px';
                    imgContainer.style.marginBottom = '10px';

                    let img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';

                    let removeButton = document.createElement('button');
                    removeButton.innerHTML = 'X';
                    removeButton.style.position = 'absolute';
                    removeButton.style.top = '5px';
                    removeButton.style.right = '5px';
                    removeButton.style.backgroundColor = 'red';
                    removeButton.style.color = 'white';
                    removeButton.style.border = 'none';
                    removeButton.style.borderRadius = '50%';
                    removeButton.style.cursor = 'pointer';

                    removeButton.onclick = function () {
                        imgContainer.remove();
                        // Remove the file from the input element
                        var dt = new DataTransfer();
                        for (var j = 0; j < input.files.length; j++) {
                            if (input.files[j] !== file) {
                                dt.items.add(input.files[j]);
                            }
                        }
                        input.files = dt.files;
                    };

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(removeButton);
                    imagesPreview.appendChild(imgContainer);
                }

                reader.readAsDataURL(file);
            }
        }
    }

    function doEditConfig() {
        debugger
        var dt = document.getElementById('formEditBanner');
        var form = new FormData(dt);

        $.ajax({
            type: 'POST',
            url: '@Url.Action("EditConfig", "Admin")',
            data: form,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.result == true) {
                    location.reload();
                }
                else {
                    showErrorMessage(response.error);
                }
            },
            error: handleException
        });
    }

    var idBanner = document.getElementById('idBanner');

    function doDeleteBanner(idBanner) {
        if (confirm("Bạn có chắc chắn xoá ảnh ?!")) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteBanner", "Admin")',
                data: { id: idBanner },
                success: function (response) {
                    if (response.result == true) {
                        showSuccessMessage("Xoá ảnh thành công");
                        //document.getElementById('imagePartner').remove();
                    }
                    else {
                        showErrorMessage(response.error);
                    }
                },
                error: handleException
            })
        }
    }
</script>

<div class="content-wrapper">
    <!-- /.card-header -->
    <!--Load GIF-->
    <div class="modalLoading"></div>



    <!-- form start -->
    <form id="formEditBanner" action="javascript:doEditConfig();" method="post" enctype="multipart/form-data">

        <div class="form-group">
            <label for="fileBase">Banner</label>
            <div class="" id="imagePartner">
                @foreach (var item in banners)
                {
                    <input type="hidden" id="idBanner" value="@item.id">
                    <img src="~/Content/Images/banner/@item.banner_image" style="width:150px; height:150px" alt="Alternate Text" />
                    <button type="button" onclick="doDeleteBanner(@item.id)">Xoá</button>
                }
            </div>
            <input type="file" class="form-control" id="fileBase" name="fileBase" multiple onchange="previewImages(event)">
            <div id="imagesPreview" style="margin-top: 10px;"></div>
        </div>

        <div class="form-group">
            <label for="description">Introduce</label>
            <input type="text" class="form-control" id="introduce" name="introduce" value="@ViewBag.SysIntroduce.value" required>
        </div>

        <div class="form-group">

            <label for="description">Address</label>
            <input type="text" class="form-control" id="address" name="address" value="@ViewBag.SysAddress.value" required>
        </div>

        <div class="form-group">
            <label for="description">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="@ViewBag.SysEmail.value" required>
        </div>

        <div class="form-group">
            <label for="description">Phone</label>
            <input type="number" class="form-control" id="phone" name="phone" value="@ViewBag.SysPhone.value" required>
        </div>

        <!-- /.card-body -->

        <div class="card-footer">
            <button type="submit" id="btnSubmit" class="btn btn-primary" value="Save">Save</button>
        </div>
    </form>
</div>
<!-- /.card -->
