
@{
    ViewBag.Title = "EditHome";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";

    var partner = ViewBag.partner as GiveAID.Models.entities.partner;
}

<script>
    function previewImages(event) {
        var input = event.target;
        var imagesPreview = document.getElementById('imagesPreview');
        imagesPreview.innerHTML = ''; // Clear any previous images

        if (input.files) {
            var filesAmount = input.files.length;

            for (let i = 0; i < filesAmount; i++) {
                let file = input.files[i];
                let reader = new FileReader();

                reader.onload = function (e) {
                    let imgContainer = document.createElement('div');
                    imgContainer.style.position = 'relative';
                    imgContainer.style.display = 'inline-block';
                    imgContainer.style.marginRight = '10px';
                    imgContainer.style.marginBottom = '10px';

                    let img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';

                    let removeButton = document.createElement('button');
                    removeButton.innerHTML = 'X';
                    removeButton.style.position = 'absolute';
                    removeButton.style.top = '5px';
                    removeButton.style.right = '5px';
                    removeButton.style.backgroundColor = 'red';
                    removeButton.style.color = 'white';
                    removeButton.style.border = 'none';
                    removeButton.style.borderRadius = '50%';
                    removeButton.style.cursor = 'pointer';

                    removeButton.onclick = function () {
                        imgContainer.remove();
                        // Remove the file from the input element
                        var dt = new DataTransfer();
                        for (var j = 0; j < input.files.length; j++) {
                            if (input.files[j] !== file) {
                                dt.items.add(input.files[j]);
                            }
                        }
                        input.files = dt.files;
                    };

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(removeButton);
                    imagesPreview.appendChild(imgContainer);
                }

                reader.readAsDataURL(file);
            }
        }
    }

    function doEditPartner() {
        var json = document.getElementById('formEditPartner');
        var form = new FormData(json);
        $.ajax({
            type: 'POST',
            url: '@Url.Action("DoEditPartner", "Admin")',
            data: form,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.result == true) {
                    showSuccessMessage("Chỉnh sửa thành công");
                    location.reload();
                }
                else {
                    showErrorMessage(response.error);
                }
            },
            error: handleException
        })
    }

    var idPartner = document.getElementById('id');

    function doDeleteImagePartner(idPartner) {
        if (confirm("Bạn có chắc chắn xoá ảnh ?!")) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteImagePartner", "Admin")',
                data: { id: idPartner },
                success: function (response) {
                    if (response.result == true) {
                        showSuccessMessage("Xoá ảnh thành công");
                        document.getElementById('imagePartner').remove();
                    }
                    else {
                        showErrorMessage(response.error);
                    }
                },
                error: handleException
            })
        }
    }
</script>

<div class="content-wrapper">

    <div class="card-header">
        @{
            if (ViewBag.IsEditing == true)
            {
                <h4 class="card-title">Edit Partner</h4>
            }
            else
            {
                <h4 class="card-title">Create Partner</h4>
            }

        }
        @*<h4 class="card-title">Edit Partner</h4>*@
    </div>
    <!-- /.card-header -->
    <!--Load GIF-->
    <div class="modalLoading"></div>



    <!-- form start -->
    <form id="formEditPartner" action="javascript:doEditPartner();" method="post" enctype="multipart/form-data">
        <div class="card-body mx-auto">
            <div class="form-group">
                <label for="Tiêu Đề">Tên Đối Tác</label>
                <input type="text" class="form-control" id="name" name="partner_name" placeholder="Tiêu Đề" value="@partner.partner_name" required>
            </div>

            <div class="form-group">
                <label for="description">Mô tả ngắn gọn</label>
                <input type="text" class="form-control" id="description" name="description" value="@partner.description" placeholder="phần mô tả này được hiển thị bên dưới tiêu đề trên trang chính" required>
            </div>

            <div class="form-group">
                <label for="fileBase">Logo</label>
                <div class="" id="imagePartner">
                    <img src="~/Content/Images/partner/@partner.partner_image" style="width:150px; height:150px" alt="Alternate Text" />
                    <button type="button" onclick="doDeleteImagePartner(@partner.id)">Xoá</button>
                </div>
                <input type="file" class="form-control" id="fileBase" name="fileBase" onchange="previewImages(event)">
                <div id="imagesPreview" style="margin-top: 10px;"></div>
            </div>

            <input type="hidden" id="id" name="id" value="@partner.id" />

            @*<input type="hidden" name="TrangThai" value="Mở" />*@

            <div class="form-group">

                <label for="description">Địa chỉ </label>
                <input type="text" class="form-control" id="address" name="address" placeholder="Ví dụ: Khu phố đèn tím" value="@partner.address" required>
            </div>

            <div class="form-group">
                <label for="description">Email </label>
                <input type="email" class="form-control" id="email" name="email" placeholder="Ví dụ: DucLOVEP2T" value="@partner.email" required>
            </div>

            <div class="form-group">
                <label for="description">Số điện thoại</label>
                <input type="number" class="form-control" id="phone" name="phone" placeholder="Ví dụ: 0908540891" value="@partner.phone" required>
            </div>

            <div>
                <input type="hidden" name="content" id="MoTa" />
            </div>




        </div>
        <!-- /.card-body -->

        <div class="card-footer">
            <button type="submit" id="btnSubmit" class="btn btn-primary" value="Save">Lưu</button>
        </div>
    </form>
</div>
<!-- /.card -->
