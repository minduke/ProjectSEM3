
@{
    ViewBag.Title = "CreateNews";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    int indexPost = 1;
    List<GiveAID.Models.entities.category> categories = new List<GiveAID.Models.entities.category>();
    if (ViewBag.category != null)
    {
        categories = ViewBag.category;
    }

    List<GiveAID.Models.entities.partner> partners = new List<GiveAID.Models.entities.partner>();
    if(ViewBag.partner != null)
    {
        partners = ViewBag.partner;
    }
    List<GiveAID.Models.entities.post> posts = new List<GiveAID.Models.entities.post>();
    if (ViewBag.post != null)
    {
        posts = ViewBag.post;
    }
}

@section scripts{
    <script src="~/Scripts/ckeditor/ckeditor.js"></script>
    <script>
        CKEDITOR.replace('content');

        $(document).ready(function (e) {
            $('#btnSubmit').click(function (e) {
                e.preventDefault();
                var dt = CKEDITOR.instances['content'].getData();
                $('#MoTa').val(dt);

                $('#formTinTuc').submit();
            })
        })
        var currentDate = new Date();
        var day = currentDate.getDate();
        var month = currentDate.getMonth() + 1; // Tháng bắt đầu từ 0, nên cần +1
        var year = currentDate.getFullYear();

        // Định dạng ngày tháng
        var formattedDate = year + "-" + month + "-" + day;

        document.getElementById("time_start").value = formattedDate;
        
        function doSubmitNews() {
            var form = document.getElementById("formTinTuc");
            var formData = new FormData(form);
            VipaddClass("loading");
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SubmitNews", "Admin")',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.result == true) {
                        VipremoveClass("loading");
                        showSuccessMessage("Tạo mới thành công");
                        form.reset();
                    } else {
                        VipremoveClass("loading");
                        showErrorMessage(response.error);
                    }
                },
                error: handleException
            })
        }

        function previewImages(event) {
            var input = event.target;
            var imagesPreview = document.getElementById('imagesPreview');
            imagesPreview.innerHTML = ''; // Clear any previous images

            if (input.files) {
                var filesAmount = input.files.length;

                for (let i = 0; i < filesAmount; i++) {
                    let file = input.files[i];
                    let reader = new FileReader();

                    reader.onload = function (e) {
                        let imgContainer = document.createElement('div');
                        imgContainer.style.position = 'relative';
                        imgContainer.style.display = 'inline-block';
                        imgContainer.style.marginRight = '10px';
                        imgContainer.style.marginBottom = '10px';

                        let img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.maxWidth = '200px';
                        img.style.maxHeight = '200px';

                        let removeButton = document.createElement('button');
                        removeButton.innerHTML = 'X';
                        removeButton.style.position = 'absolute';
                        removeButton.style.top = '5px';
                        removeButton.style.right = '5px';
                        removeButton.style.backgroundColor = 'red';
                        removeButton.style.color = 'white';
                        removeButton.style.border = 'none';
                        removeButton.style.borderRadius = '50%';
                        removeButton.style.cursor = 'pointer';

                        removeButton.onclick = function () {
                            imgContainer.remove();
                            // Remove the file from the input element
                            var dt = new DataTransfer();
                            for (var j = 0; j < input.files.length; j++) {
                                if (input.files[j] !== file) {
                                    dt.items.add(input.files[j]);
                                }
                            }
                            input.files = dt.files;
                        };

                        imgContainer.appendChild(img);
                        imgContainer.appendChild(removeButton);
                        imagesPreview.appendChild(imgContainer);
                    }

                    reader.readAsDataURL(file);
                }
            }
        }

        function previewThumbnail(event) {
            var input = event.target;
            var imagesPreview = document.getElementById('thumb');
            imagesPreview.innerHTML = ''; // Clear any previous images

            if (input.files) {
                var filesAmount = input.files.length;

                for (let i = 0; i < filesAmount; i++) {
                    let file = input.files[i];
                    let reader = new FileReader();

                    reader.onload = function (e) {
                        let imgContainer = document.createElement('div');
                        imgContainer.style.position = 'relative';
                        imgContainer.style.display = 'inline-block';
                        imgContainer.style.marginRight = '10px';
                        imgContainer.style.marginBottom = '10px';

                        let img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.maxWidth = '200px';
                        img.style.maxHeight = '200px';

                        let removeButton = document.createElement('button');
                        removeButton.innerHTML = 'X';
                        removeButton.style.position = 'absolute';
                        removeButton.style.top = '5px';
                        removeButton.style.right = '5px';
                        removeButton.style.backgroundColor = 'red';
                        removeButton.style.color = 'white';
                        removeButton.style.border = 'none';
                        removeButton.style.borderRadius = '50%';
                        removeButton.style.cursor = 'pointer';

                        removeButton.onclick = function () {
                            imgContainer.remove();
                            // Remove the file from the input element
                            var dt = new DataTransfer();
                            for (var j = 0; j < input.files.length; j++) {
                                if (input.files[j] !== file) {
                                    dt.items.add(input.files[j]);
                                }
                            }
                            input.files = dt.files;
                        };

                        imgContainer.appendChild(img);
                        imgContainer.appendChild(removeButton);
                        imagesPreview.appendChild(imgContainer);
                    }

                    reader.readAsDataURL(file);
                }
            }
        }
    </script>
}
<style>
    .content-vip {
        display: flex;
        justify-content: center;
    }

    .content-baby {
        flex: 1;
        text-align: center;
    }


    .nav-tabs .nav-item .nav-link.active {
        color: mediumvioletred; /* Thay đổi màu khi tab được kích hoạt */
        border-bottom: 2px solid #FF3399; /* Thay đổi màu và đường kẻ dưới khi tab được kích hoạt */
        background-color: whitesmoke;
    }
</style>
<div class="content-wrapper">

    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">New Posts</h1>
                </div><!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Admin</a></li>
                        <li class="breadcrumb-item active">Create News</li>
                    </ol>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->
    <!--Load GIF-->
    <div class="modalLoading"></div>

    <div class="content">


        <ul class="nav nav-tabs content-vip" role="tablist">
            <li class="nav-item content-baby">
                <!--Table 1-->
                <a class="nav-link active" data-toggle="tab" href="#view">Views Posts</a>
            </li>
            <li class="nav-item content-baby">
                <!--Table 2-->
                <a class="nav-link" data-toggle="tab" href="#createNews">Create News</a>
            </li>
        </ul>
        <!-- Tab panes -->
        <div class="tab-content" style="width:100%">
            <div id="view" class="container tab-pane active table-responsive-md">
                <br>
                <div class="row mb-2">

                    <h5>List of articles</h5>
                    <!--Table 1-->
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Background</th>
                                <th scope="col">Title</th>
                                <th scope="col">Target</th>
                                <th scope="col">End date</th>
                                <th scope="col">Edit</th>
                                <th scope="col">Tới Tháng  <!--Nut check-box--></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in posts)
                            {
                                <tr>
                                    <th scope="row">@(indexPost++)</th>
                                    <td><img style="width:150px; height:150px" src="~/Content/Images/post/@item.image" alt="Alternate Text" /></td>
                                    <td>@item.title</td>
                                    <td>@Convert.ToInt64(item.target).ToString("N0") VND</td>
                                    <td>@item.time_end.Value.ToShortDateString()</td>
                                    <td><a href="@Url.Content("~/Admin/EditDetail/")@item.id">See more</a></td>
                                    <td>
                                        <!--Nut check-box-->
                                        <div class="checkbox-wrapper-55">
                                            <label class="rocker rocker-small">
                                                <input type="checkbox" id="myCheckbox">
                                                <span class="switch-left">Mở</span>
                                                <span class="switch-right">Đóng</span>
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <!--Table 1-->
                </div>
            </div>

            <div id="createNews" class="container tab-pane fade table-responsive-md">
                <div class="row mb-2">
                    <!-- form start -->
                    <form id="formTinTuc" action="javascript:doSubmitNews();" method="post" enctype="multipart/form-data">
                        <div class="card-body mx-auto">
                            <div class="form-group">
                                <label for="Tiêu Đề">Tiêu Đề</label>
                                <input type="text" class="form-control" id="title" name="title" placeholder="Tiêu Đề" required>
                            </div>

                            @*<div class="form-group">
                    <label for="description">Mô tả ngắn gọn</label>
                    <input type="text" class="form-control" id="description" name="description" placeholder="phần mô tả này được hiển thị bên dưới tiêu đề trên trang chính" required>
                </div>*@

                            <div class="form-group">
                                <label for="fileBase">Ảnh nền</label>


                                <input type="file" class="form-control" id="thumbnail" name="thumbnail" required onchange="previewThumbnail(event)">
                                <div id="thumb" style="margin-top: 10px;"></div>

                            </div>

                            <div class="form-group">
                                <label for="fileBase">Hình ảnh liên quan</label>


                                <input type="file" class="form-control" id="fileBase" name="fileBase" required multiple onchange="previewImages(event)">
                                <div id="imagesPreview" style="margin-top: 10px;"></div>

                            </div>

                            <input type="hidden" id="time_start" name="time_start" value="" />

                            @*<input type="hidden" name="TrangThai" value="Mở" />*@

                            <div class="form-group">
                                <label for="target">Số tiền mục tiêu</label>
                                <input type="number" class="form-control" id="target" name="target" placeholder="" required>
                            </div>

                            <div class="form-group">
                                <label for="content">Nội dung bài viết</label>
                                <input type="text" class="form-control" id="content" placeholder="Nội dung bài viết" required>
                            </div>

                            <div>
                                <input type="hidden" name="content" id="MoTa" />
                            </div>

                            <div class="form-group">
                                <label>Lĩnh vực</label>
                                <select class="form-control" name="cate_id">
                                    @foreach (var item in categories)
                                    {
                                        <option value="@item.cate_id">@item.name</option>
                                    }
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Đối tác</label>
                                <select class="form-control" name="partner_id">
                                    @foreach (var item in partners)
                                    {
                                        <option value="@item.id">@item.partner_name</option>
                                    }
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="time_end">Ngày kết thúc quyên góp</label>
                                <input type="date" class="form-control" id="time_end" name="time_end" required>
                            </div>


                        </div>
                        <!-- /.card-body -->

                        <div class="card-footer">
                            <button type="submit" id="btnSubmit" class="btn btn-primary" value="Save">Lưu</button>
                        </div>
                    </form>


                </div>
            </div>

        </div>
      
    </div>


  
</div>
<!-- /.card -->
